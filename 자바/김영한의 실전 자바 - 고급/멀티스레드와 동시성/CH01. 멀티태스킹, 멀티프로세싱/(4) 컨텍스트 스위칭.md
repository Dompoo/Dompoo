# 컨텍스트 스위칭

- 멀티태스킹이 반드시 효율적인 것은 아니다.
- 스레드A가 실행되다가 스레드B를 다시 실행하는 순간 다음과 같은 작업이 필요하다.
  - 현재 프로세스의 상태를 저장한다.
  - 다음으로 실행할 프로세스의 상태를 복원한다.
  - 메모리 공간과 캐시를 재설정한다.
- 이 과정을 **컨텍스트 스위칭**이라고 부른다.
  - 이것을 줄이기 위해 운영체제는 최적의 구조를 설계하고 수행한다. (소프트웨어 개선)
  - 또한 CPU 코어를 늘리는 방법으로 동시 수행하는 스레드 양을 늘리면 컨텍스트 스위칭 과정이 줄어든다. (하드웨어 개선)
- 애플리케이션 개발자가 할 수 있는 것은 보통 **애플리케이션의 스레드의 개수를 조절**하는 것이다.
  - 스레드가 CPU 코어보다 적으면 : CPU를 100% 활용할 수 없다.
  - 스레드가 CPU 코어보다 압도적으로 많으면 : 컨텍스트 스위칭이 많이 일어나서 느려진다.

## CPU 바운드 작업 VS I/O 바운드 작업

- CPU 바운드 작업
  - CPU의 연산 능력을 많이 요구하는 작업
  - 알고리즘 실행, 계산, 데이터 처리 등
- I/O 바운드 작업
  - 디스크, 네트워크, 파일시스템 같은 입출력을 많이 사용하는 작업
  - I/O 작업이 끝나기 전까지 CPU가 상대적으로 대기 상태에 있는다.
- 애플리케이션과 같은 경우에는 I/O 바운드 작업이 상대적으로 훨씬 많다.
  - 4개의 API 요청이 들어오면 4개의 스레드가 필요하고, 각 스레드는 CPU를 매우 적게 사용하며 DB의 응답을 기다릴 뿐이다.
  - 이 경우에는 어차피 CPU가 대기하므로 4개 스레드 외에도 다른 스레드를 받아서(다른 사용자 요청을 받도록 스레드 개수+) 어차피 대기할 때 다른 스레드를 조금이라도 처리하는 것이 이득이다.
