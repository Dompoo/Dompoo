# ExecutorService의 스레드 풀

- `corePoolSize` : 스레드 풀에서 관리되는 기본 스레드 수
- `maximumPoolSize` : 스레드 풀에서 관리되는 최대 스레드 수
- `keepAliveTime`, `TimeUnit` : 기본 스레드 수를 초과하여 만들어진 초과 스레드가 최대로 생존할 수 있는 대기 시간, **이 시간동안 초과 스레드가 처리할 작업이 없다면 초과 스레드는 제거된다.**
- `BlockingQueue` : 작업을 보관할 블로킹 큐

## maximum의 개념

- 기본 스레드가 2개, 맥시멈이 4개일 때
  - 3개 작업을 넣으면 스레드가 3개 생길까?
  - 아니다! 2개 스레드가 만들어지고, 2개는 블로킹 큐에 들어간다.
- `maximum`은 블로킹큐의 크기가 최대에 도달했을 때 넣는 것이다.

1. 기본 스레드, 초과 스레드 0개로 `ExecutorService`가 시작한다.
2. 기본 스레드 개수까지 스레드를 만들며 늘린다.
3. 기본 스레드 개수가 모두 사용되면, 작업을 블로킹큐에 넣는다.
4. 블로킹큐도 모두 차면 최대 스레드 개수까지 스레드를 만들며 작업을 수행한다.
5. 블로킹큐도 가득 차고 최대 스레드 개수도 모두 찬 상태에서 작업이 더 들어오면 예외가 발생한다.
6. 초과 스레드가 작업을 끝내고 따로 처리할 작업이 없을 때부터 대기 시간이 돌아간다.
7. 초과 스레드가 최대 생존 대기 시간만큼 처리할 작업이 없다면 초과 스레드가 제거된다.

- 초과 스레드가 일정 시간동안 처리할 작업이 없을 때 삭제되는 것에서 알 수 있듯, 초과 스레드는 **최후의 보루**이다.
- **웬만하면 늘어나지 않고, 처리할 작업이 병목되는(블로킹큐가 가득 차는) 긴급 상황에서만 늘어난다.**
- 다시 정상 상황이 되면 초과 스레드를 삭제하며 원래대로 작업을 수행한다.

## 기본 스레드 미리 생성하기

- 응답 시간이 매우 중요한 경우, 기본 스레드를 요청이 왔을 때 만드는 것이 아니라 미리 만들어두고 싶을 수 있다.
- `ThreadPoolExecutor.prestartAllCoreThreads()`를 통해 기본 스레드를 미리 생성할 수 있다.
