# 동시성, 동기화란?

- 멀티스레드 환경에서 가장 주의해야 하는 것은 **공유 자원**이다.
- 공유 자원에 대한 접근을 적절하게 동기화하는 것이 중요하다.
  - 동기화한다는 것은 여러 스레드에서 동일한 내용을 보도록 하는 것이다.
- 예를 들어, 멀티스레드 환경에서 동작하는 은행 계좌 도메인에서, 동시에 동일한 계좌 잔액을 보는 것은 매우 중요하다.
  - 만약 두 스레드에서 동일한 계좌의 잔액을 다르게 본다면? -> 동기화 문제
  - 만약 두 스레드에서 동일한 계좌의 잔액을 동시에 수정하려고 한다면? -> 동시성 문제
    - 이는 `volatile`만으로 해결되지 않을 수 있다.
    - 자바의 각 코드는 atomic 하게 실행되지 않으므로, 조건문을 통과하는 순서에 따라 결과가 달라진다.

## 동시성 문제 예시

- t1, t2가 동일 계좌에서 돈을 출금하려고 한다.
  - 출금양이 잔액보다 많으면 예외가 발생한다.
- t1이 먼저 접근한다. `if(잔액 < 출금양)` 조건문을 통과하고 돈을 출금하기 직전까지 간다.
- t2가 다음에 접근한다. `if(잔액 < 출금양)` 조건문을 통과하고 돈을 출금하기 직전까지 간다.
- t1에서 돈이 출금 완료된다. 잔액은 이제 출금양보다 적어졌다.
- 하지만 t2에서는 이를 감지하지 못한다. 이미 조건문을 통과하여 출금을 시도해버리기 때문이다.
- 또 다른 접근 순서에 따라 결과는 매우매우 달라질 수 있다...
