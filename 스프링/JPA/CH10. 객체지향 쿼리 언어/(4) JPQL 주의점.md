# JPQL 주의점

## 자동 플러시

- 트랜잭션 커밋 시점에도 플러시가 호출되지만, **JPQL 쿼리 실행시 자동으로 플러시가 호출된다.**
- 이는 JPQL로 쿼리하기 이전에, 영속성 컨텍스트의 변경 사항을 DB에 반영하기 위함이다.

## 벌크 연산 (UPDATE, DELETE)

- `remove()` 등의 메서드를 여러번 호출하는 것이 비효율적일때, JPQL을 통해 한번에 수정/삭제할 수 있다.
- 이를 벌크 연산이라고 하는데, **벌크 연산은 영속성 컨텍스트를 무시하고 DB에 직접 쿼리**한다.
- 따라서 벌크 연산 직후에 실제 데이터와 영속성 컨텍스트 사이 차이가 발생할 수 있으므로 `refresh()`할 필요가 있다.

## 영속성 컨텍스트에 이미 존재하는 엔티티

- 영속성 컨텍스트에 이미 존재하는 엔티티의 경우 **DB에서 조회한 결과를 버리고 기존 영속성 컨텍스트의 엔티티를 사용한다.**
  - 이때 존재하는지 여부는 DB에서 조회해온 엔티티의 식별자값을 통해서 한다.
- 영속성 컨텍스트에 없는 엔티티의 경우에만 DB에서 조회해온 값이 영속성 컨텍스트에 반영된다.
