# 테스트를 해야 하는 이유와 테스트의 분류

### 레거시 코드란?
- 'Working Effectively with Legacy Code'
  - 테스트 코드가 없는 코드를 레거시코드라고도 부른다.

# 테스트를 해야 하는 이유
- Regression(회귀)
  - 코드가 없던 시절, 즉 기능이 제대로 작동하지 않는 상황으로 돌아간다는 것
  - 회귀방지 테스트가 없다면 어떠한 기능을 추가로 개발할 때, 문제가 없다는 것을 어느정도 보증받을 수 있다.
  - 구글에서 이런 회귀방지 테스트가 없어서 릴리즈시마다 버그가 생기기 일수였다고 한다.
- 개발자의 성장
  - 코드를 짜다보면 관성적으로 개발하게 되는 부분이 있다.
  - 10년을 개발해도 10년치의 깊은 지식이 생기는 것이 아니라, 3년짜리 지식을 3번 반복하는 일이 될 수 있다.
  - 이런 일을 피하려면 미리 테스트를 공부하고 짜야 한다.

# 테스트의 분류
- 인수 테스트 : 체크리스트로 인수를 사람이 하나하나 체크하는 것
- 자동 테스트 : 소프트웨어를 통해 필요한 인수들을 자동으로 테스트하는 것
- 테스트피라미드
  - API 테스트 5%
  - 통합 테스트 15%
  - 단위 테스트 80%
  - 이렇게 나뉘긴 하지만, 통합 테스트의 정의에 대한 논란이 많다.(런던파 고전파 등)- 이런 애매모호함을 풀어낸 책이 있다.
- '구글 엔지니어는 이렇게 일한다.' 
  - 소형 테스트
    - 단일 서버, 단일 프로세스, 단일 스레드로 작동한다.
    - 디스크 I/O, Blocking Call도 없어야 한다.
    - 이런 소형 테스트는 단위 테스트와도 같은 의미이다.
    - 테스트 입력이 같을 때, 결과는 항상 같다.
  - 중형 테스트
    - 멀티 프로세스, 멀티 스레드로 작동한다.
    - H2같은 테스트용 DB를 사용할 수 있게 된다.
    - 멀티 스레드 환경에서 항상 동일하게 동작한다는 것을 보장받지 못한다.
  - 대형 테스트
    - 멀티 서버로 작동한다.
    - 보통 E2E 테스트를 뜻한다.

### 어떻게 해야 하는가
- 소형(단위) 테스트를 차근차근 늘려가고 많이 확보해야 한다.
- 그 후에 다른 테스트도 천천히 추가해야 한다.

# 안티패턴
- 아이스크림 패턴
  - 테스트 피라미드의 형태가 역으로 뒤집혀, API 테스트가 많아지는 것이다.
  - 이런 테스트의 경우, 외부 환경에 많이 의존하기 때문에 실패하기 쉽다.